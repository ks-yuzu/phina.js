<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
phina.namespace(function() {

<span id='phina-app-Element'>  /**
</span>   * @class phina.app.Element
   * @extends phina.util.EventDispatcher
   * # 主に要素の親子関係を扱うクラス
   * 主に親子関係等を定義するクラスです。
   */
  phina.define(&#39;phina.app.Element&#39;, {
    superClass: &#39;phina.util.EventDispatcher&#39;,

<span id='phina-app-Element-property-parent'>    /**
</span>     * @property parent
     * 親要素
     */
    parent: null,

<span id='phina-app-Element-property-children'>    /**
</span>     * @property children
     * 子要素
     */
    children: null,

<span id='phina-app-Element-property-awake'>    /**
</span>     * @property awake
     * 有効かどうか
     */
    awake: true,

<span id='phina-app-Element-method-constructor'>    /**
</span>     * @constructor
     */
    init: function() {
      this.superInit();
      this.children = [];
    },

<span id='phina-app-Element-method-addChild'>    /**
</span>     * @method addChild
     * 自身に子要素を追加します。
     *
     * 自身を子要素として引数で指定した要素に追加するには {@link #addChildTo} を使用してください。
     *
     * @param {Object} child 追加する子要素
     */
    addChild: function(child) {
      if (child.parent) child.remove();

      child.parent = this;
      this.children.push(child);

      child.has(&#39;added&#39;) &amp;&amp; child.flare(&#39;added&#39;);

      return child;
    },
<span id='phina-app-Element-method-addChildTo'>    /**
</span>     * @method addChildTo
     * 自身を子要素として引数で指定した要素に追加します。
     *
     * 自身に子要素を追加するには {@link #addChild} を使用してください。
     *
     * @param {Object} parent 自身を子要素として追加する要素
     */
    addChildTo: function(parent) {
      parent.addChild(this);

      return this;
    },
<span id='phina-app-Element-method-addChildAt'>    /**
</span>     * @method addChildAt
     * 自身を、指定した要素の子要素の任意の配列インデックスに追加します。
     *
     * @param {Object} child 追加する子要素
     * @param {Number} index インデックス番号
     */
    addChildAt: function(child, index) {
      if (child.parent) child.remove();

      child.parent = this;
      this.children.splice(index, 0, child);

      child.has(&#39;added&#39;) &amp;&amp; child.flare(&#39;added&#39;);

      return child;
    },
<span id='phina-app-Element-method-getChildAt'>    /**
</span>     * @method getChildAt
     * 指定したインデックスの子要素を返します。
     *
     * @param {Number} index インデックス番号
     * @return {Object} 指定したインデックスの子要素
     */
    getChildAt: function(index) {
      return this.children.at(index);
    },
<span id='phina-app-Element-method-getChildByName'>    /**
</span>     * @method getChildByName
     * 指定した名前の子要素を返します。（未実装）
     */
    getChildByName: function(name) {
      // TODO:
    },
<span id='phina-app-Element-method-getChildIndex'>    /**
</span>     * @method getChildIndex
     * 指定した子要素のインデックス番号を返します。
     *
     * @param {Object} child 子要素
     * @return {Number} 指定した子要素のインデックス番号
     */
    getChildIndex: function(child) {
      return this.children.indexOf(child);
    },
<span id='phina-app-Element-method-getParent'>    /**
</span>     * @method getParent
     * 指定した要素の親要素を返します。
     *
     * @return {Object} 指定した要素の親要素
     */
    getParent: function() {
      return this.parent;
    },
<span id='phina-app-Element-method-getRoot'>    /**
</span>     * @method getRoot
     * 指定した要素の階層ツリーのルートを返します。
     *
     * @return {Object} 指定した要素の階層ツリーのルート
     */
    getRoot: function() {
      var elm = this;
      for (elm=this.parent; elm.parent != null; elm = elm.parent) {

      }
      return elm;
    },
<span id='phina-app-Element-method-removeChild'>    /**
</span>     * @method removeChild
     * @chainable
     * 指定した要素を自身の子要素から削除します。
     *
     * @param {Object} child 要素
     */
    removeChild: function(child) {
      var index = this.children.indexOf(child);
      if (index !== -1) {
        this.children.splice(index, 1);
        child.has(&#39;removed&#39;) &amp;&amp; child.flare(&#39;removed&#39;);
      }
      return this;
    },
<span id='phina-app-Element-method-remove'>    /**
</span>     * @method remove
     * 自身を親要素の子要素から削除します。
     */
    remove: function() {
      if (!this.parent) return ;

      this.parent.removeChild(this);
      this.parent = null;

      return this;
    },
<span id='phina-app-Element-method-isAwake'>    /**
</span>     * @method isAwake
     * 自身が有効かどうかを返します。
     *
     * @return {Boolean} 有効かどうか
     */
    isAwake: function() {
      return this.awake;
    },
<span id='phina-app-Element-method-wakeUp'>    /**
</span>     * @method wakeUp
     * 自身を有効にします。
     */
    wakeUp: function() {
      this.awake = true;
      return this;
    },
<span id='phina-app-Element-method-sleep'>    /**
</span>     * @method sleep
     * 自身を無効にします。
     */
    sleep: function() {
      this.awake = false;
      return this;
    },
<span id='phina-app-Element-method-fromJSON'>    /**
</span>     * @method fromJSON
     * JSON 形式を使って自身に子要素を追加することができます。
     *
     * ### Example
     *      this.fromJSON({
     *        &quot;children&quot;: {
     *          &quot;label&quot;: {                  //キー名が追加する子要素の名前になる
     *            &quot;className&quot;: &quot;Label&quot;,     //クラス
     *            &quot;arguments&quot;: [&#39;hello!&#39;],  //初期化時の引数
     *            &quot;x&quot;:320,                  //その他プロパティ
     *            &quot;y&quot;:480,
     *          },
     *        },
     *      });
     *
     * @param {JSON} json JSON 形式
     */
    fromJSON: function(json) {

      var createChildren = function(name, data) {
        //
        var args = data.arguments;
        args = (args instanceof Array) ? args : [args];
        //
        var _class = phina.using(data.className);
        //
        var element = _class.apply(null, args);

        element.name = name;
        this[name] = element;

        element.fromJSON(data);
        element.addChildTo(this)
      }.bind(this);

      json.forIn(function(key, value) {
        if (key === &#39;children&#39;) {
          value.forIn(function(name, data) {
            createChildren(name, data);
          });
        }
        else {
          if (key !== &#39;type&#39; &amp;&amp; key !== &#39;className&#39;) {
            this[key] = value;
          }
        }
      }, this);

      return this;
    },
<span id='phina-app-Element-method-toJSON'>    /**
</span>     * @method toJSON
     * 自身の子要素を JSON 形式で返します。
     *
     * @return {JSON} JSON形式
     */
    toJSON: function() {
      var keys = Object.keys(phina.using(this.className).defaults || {});

      this._hierarchies.forEach(function(e) {
        var d = e.defaults;
        if (d) {
          Object.keys(d).forEach(function(k) {
            if (keys.indexOf(k) === -1) {
              keys.push(k);
            }
          });
        }
      });

      keys.push(&#39;name&#39;, &#39;className&#39;);

      var json = {};
      keys.each(function(key) {
        json[key] = this[key];
      }, this);

      var children = this.children.map(function(child) {
        return child.toJSON();
      });

      if (children.length) {
        json.children = {};
        children.each(function(child, i) {
          json.children[child.name || (child.className + &#39;_&#39; + i)] = child;
        });
      }

      return json;
    },
  });

});
</pre>
</body>
</html>
